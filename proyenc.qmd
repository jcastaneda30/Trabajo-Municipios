---
title: "Mapas del Departamento del Cauca"
author: 
  - "Juan Camilo Gutiérrez Martínez CC 1033486192"
  - "Maria Fernanda Calle Agudelo CC 1033428469"
  - "Jaider Castañeda Villa CC 1001015442"
date: last-modified
format: 
  html:
    toc: true
editor: visual
execute:
  echo: false
  warning: false
  message: false
---

# Introducción

# Objetivos

# Metodología y Procedimientos

# Mapas

## Mapa del departamento

```{r}
library(sf)
library(ggplot2)
library(dplyr)
library(stringi)              # Cada vez que lo uses

# Cargar archivo GeoJSON
geo_data <- st_read("municipios_GeoJSON.geojson", quiet = TRUE)

# Convertir columna dpt a texto
geo_data$dpt <- as.character(geo_data$dpt)

# Filtrar solo Cauca
geo_cauca <- geo_data %>% filter(dpt == "CAUCA")
geo_cauca <- geo_cauca %>% filter(!is.na(name))
geo_cauca$name <- stri_trans_general(geo_cauca$name, "Latin-ASCII")

municipios <- unique(geo_cauca$name)
colores_personalizados <- setNames(
  rainbow(length(municipios)),  # o cualquier otro vector de colores
  municipios
)

ggplot(geo_cauca) +
  geom_sf(aes(fill = name), color = "black", size = 0.2) +
  scale_fill_manual(values = colores_personalizados) +
  theme_minimal() +
  labs(title = "Municipios del departamento del Cauca") +
  theme(legend.position = "none")   # <- oculta la leyenda


```

## Distribución de la pobreza

```{r}
library(readxl)
library(dplyr)
library(viridis)  # opcional, para una paleta perceptualmente uniforme

nbi_data <- read_excel("CNPV-2018-NBI.xlsx", sheet = "Municipios")
nbi_data_cauca <- nbi_data %>% filter(`Nombre Departamento` == "CAUCA")

nbi_reducido <- nbi_data_cauca %>%
  select(`Nombre Municipio`, `Prop de Personas en NBI (%)...5`)

nbi_reducido$`Nombre Municipio` <- stri_trans_general(nbi_reducido$`Nombre Municipio`, "Latin-ASCII")

geo_json_with_nbi <- left_join(geo_cauca, nbi_reducido, by = c("name" = "Nombre Municipio"))


ggplot(geo_json_with_nbi) +
  geom_sf(aes(fill = `Prop de Personas en NBI (%)...5`), color = "black", size = 0.2) +
  scale_fill_gradientn(
    colours = c("green", "yellow", "orange", "red"),
    name = "NBI (%)"
  ) +
  theme_minimal() +
  labs(title = "Índice de Necesidades Básicas Insatisfechas (NBI) - Cauca")

```

## Índice de desempeño fiscal

El Índice de Desempeño Fiscal (IDF) de un municipio es una herramienta que mide la gestión financiera de una entidad territorial (municipio o departamento) en Colombia, evaluando su capacidad para generar ingresos propios, manejar sus deudas, invertir eficientemente y cumplir con las normativas fiscales. En esencia, refleja qué tan bien un municipio administra sus recursos económicos.

Para el ejercicio, nos vamos a enfocar en los municipios del departamento del Cauca, los datos se obtuvieron de la página web del Departamento Nacional de Planeación
de Colombia, <https://www.dnp.gov.co/LaEntidad_/subdireccion-general-descentralizacion-desarrollo-territorial/direccion-descentralizacion-fortalecimiento-fiscal/Paginas/informacion-fiscal-y-financiera.aspx> actualizado al año 2023.

El mapa muestra la clasificación de cada municipio del Cauca en base a su índice de desempeño fiscal. En la documentación oficial la clasificación está definida así:

- 1. Deterioro (<40)
- 2. Riesgo (>=40 y <60)
- 3. Vulnerable (>=60 y <70)
- 4. Solvente (>=70 y <80)
- 5. Sostenible (>=80)

```{r}
idf_data <- read_excel("ResultadosIDF_2023.xlsx", sheet = "Municipios 2023")
idf_data_cauca <- idf_data %>% filter(`Departamento` == "CAUCA")

idf_reducido <- idf_data_cauca %>%
  select(`Código`,`Municipio`, `Nuevo IDF`,`Rango`)

idf_reducido$`Municipio` <- stri_trans_general(idf_reducido$`Municipio`, "Latin-ASCII")

geo_json_with_idf <- left_join(geo_cauca, idf_reducido, by = c("id" = "Código"))

ggplot(geo_json_with_idf) +
  geom_sf(aes(fill = Rango), color = "black", size = 0.2) +
  scale_fill_manual(
    values = c(
      "1. Deterioro (<40)" = "red",
      "2. Riesgo (>=40 y <60)" = "orange",
      "3. Vulnerable (>=60 y <70)" = "yellow",
      "4. Solvente (>=70 y <80)" = "lightgreen",
      "5. Sostenible (>=80)" = "green" 
    ),
    name = "Clasificación Municipio"
  ) +
  theme_minimal() +
  labs(title = "Índice Desempeño Fiscal (IDF) 2023- Cauca")



```
El mapa anterior nos da un vistazo general de las condiciones del departamento del Cauca respecto al IDF, lo primero que se ve es que
hay cierta homogeneidad, pues solo hay municipios de dos tipos, en riesgo y vulnerables. Premisa que nos lleva a pensar que el Cauca
tiene ciertas limitaciones ecónomicas en sus municipios y no muestran un buen desempeño en los parámetros utilizados para calcular el IDF.

Vamos a hacer un análisis más profundo:

```{r}
summary(idf_reducido$`Nuevo IDF`)
```

Se puede ver que la media del IDF de todos los municipios es de 54.91, hay un valor
máximo de 69.46 y un valor mínimo de 41.65.

Ahora miremos la desviación estándar:

```{r}
sd(idf_reducido$`Nuevo IDF`)
```

La desviación estándar es baja, lo que reafirma la afirmación de que en cuanto al IDF el departamento del Cauca es muy homogéneo.

Estos son los cincos municipios con más alto IDF:

```{r}
top5 <- idf_reducido[order(-idf_reducido$`Nuevo IDF`), ][1:5, ]
print(top5)
```
El municipio Lopez De Micay tiene el índice de desempeño fiscal más alto del departamento.

Estos son los cincos municipios con más bajo IDF:

```{r}
top5_bajo <- idf_reducido[order(idf_reducido$`Nuevo IDF`), ][1:5, ]
print(top5_bajo)
```
El municipio de Silvia tiene el IDF más bajo y se encuentra en el límite a
convertirse un municipio en deteriorio. (menor a 40).

## Distancia a la capital

Para la elaboración de este mapa se recopilaron las distancias por carretera entre los distintos municipios y la capital (Popayán). Los datos se obtuvieron a través del sitio web <https://colombia.mejoresrutas.com/tabla-de-distancias/co-cauca/>, el cual permite consultar la distancia vial entre dos municipios de Colombia. Utilizando la lista de municipios del departamento del Cauca previamente recopilada, se construyó una tabla que muestra la distancia por carretera desde cada uno de ellos hacia Popayán. Esta información fue descargada como un archivo en formato `.xls`, el cual será utilizado como fuente de datos para la elaboración del mapa.

Primero vamos a realizar un análisis de los datos:

El mapa presentado muestra el departamento del Cauca, donde cada municipio está coloreado de acuerdo con su distancia a la ciudad de Popayán. Se utiliza una escala de colores que va del azul (municipios más cercanos) al rojo (municipios más lejanos), permitiendo visualizar de forma clara y comparativa qué tan alejado se encuentra cada municipio respecto a la capital.

```{r}
#Leer el archivo que contiene las distancias a la capital
dist_data_cauca <- read_excel("co-cauca.xls")

#Normalizar y poner en mayúscula los nombres de los municipios
dist_data_cauca$Municipio <- toupper(stri_trans_general(dist_data_cauca$Municipio, "Latin-ASCII"))

#Unir los datos espaciales con las distancias
geo_json_with_dist <- left_join(geo_cauca, dist_data_cauca, by = c("name" = "Municipio"))

#Se usa ggplot() para crear un mapa temático a partir del objeto geo_json_with_dist, que contiene geometría y datos de distancia. Con geom_sf() se dibuja los municipios y se les asigna un color según la columna Distancia a Popayán (Km); scale_fill_gradientn() define los colores de la escala, mientras theme_minimal() y labs() ajustan la estética y el título del gráfico.

ggplot(geo_json_with_dist) +
  geom_sf(aes(fill = `Distancia a Popayán (Km)`), color = "black", size = 0.2) +
  scale_fill_gradientn(
    colours = c("blue", "lightblue", "yellow", "red"),
    name = "Distancia a Popayán (Km)"
  ) +
  theme_minimal() +
  labs(title = "Distancia de los municipios del Cauca a Popayán") +
  theme(legend.position = "right")

```

Se observa que los municipios más cercanos, ubicados en el centro del departamento, se representan en tonos azules, mientras que aquellos más alejados, principalmente al sur y en zonas periféricas, presentan colores que van del amarillo al rojo. Esto indica una mayor lejanía respecto a la capital. El patrón de color evidencia que la mayor concentración de municipios se encuentra en un rango intermedio de distancia, mientras que solo algunos municipios, como el ubicado al extremo sur (Piamonte), superan los 300 kilómetros.

# Conclusiones

# Recomendaciones

# Cibergrafía

OpenAI. (2025). ChatGPT \[Modelo de lenguaje AI\]. Recuperado de <https://chat.openai.com>

Mejores Rutas. Calculadora de distancia de conducción en Cauca. Recuperado de <https://colombia.mejoresrutas.com/tabla-de-distancias/co-cauca/>
